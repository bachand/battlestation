#!/usr/bin/env ruby

# Simple script to manage symlinks from config/symlinks.yaml

require 'optparse'
require 'pathname'

# Add lib directory to load path
script_dir = Pathname.new(__FILE__).dirname
$LOAD_PATH.unshift(script_dir.parent.join('lib'))

require 'battlestation/symlink_manager'

# Parse options
action = :create
verbose = true

OptionParser.new do |opts|
  opts.banner = "Usage: #{File.basename(__FILE__)} [options] [yaml_path]"
  opts.on('-c', '--create', 'Create symlinks (default)') { action = :create }
  opts.on('-s', '--status', 'Show symlink status') { action = :status }
  opts.on('-r', '--remove', 'Remove symlinks') { action = :remove }
  opts.on('-q', '--quiet', 'Suppress verbose output') { verbose = false }
  opts.on('-h', '--help', 'Show help') { puts opts; exit }
end.parse!

# Determine config file
config_path = ARGV[0] || script_dir.parent.join('config/symlinks.yaml')
repo_root = script_dir.parent

begin
  manager = Battlestation::SymlinkManager.new(config_path, repo_root: repo_root, verbose: verbose)
  
  case action
  when :create
    exit manager.create_all ? 0 : 1
  when :status
    manager.status
  when :remove
    manager.remove_all
  end
rescue => e
  puts "Error: #{e.message}"
  exit 1
end
